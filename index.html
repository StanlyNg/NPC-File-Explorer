<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NPC File Explorer — 演示版</title>
  <meta name="description" content="网页版文件浏览器原型 - 可响应、多设备适配、管理后台、深浅色模式" />
  <style>
    /* ---------- Reset & base ---------- */
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#1E90FF; --glass: rgba(255,255,255,0.04);
      --text:#e6eef8; --danger:#f43f5e; --white:#fff; --radius:14px;
    }
    [data-theme="light"]{
      --bg:#f6f9fc; --card:#ffffff; --muted:#546069; --accent:#0366d6; --glass: rgba(0,0,0,0.04);
      --text:#0b1220; --danger:#b91c1c; --white:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,var(--bg),rgba(0,0,0,0.02));color:var(--text)}
    a{color:inherit}
    .container{max-width:1080px;margin:28px auto;padding:20px}

    /* ---------- Header ---------- */
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6ee7b7);display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:700}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--card);border:1px solid var(--glass);padding:8px 12px;border-radius:10px;cursor:pointer}

    /* ---------- Layout ---------- */
    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px}
    @media (max-width:880px){.layout{grid-template-columns:1fr} .sidebar{order:2}}

    /* ---------- Sidebar ---------- */
    .sidebar{background:var(--card);padding:14px;border-radius:12px;border:1px solid var(--glass)}
    .sidebar h3{margin:0 0 8px 0}
    .navitem{padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .navitem:hover{background:var(--glass)}

    /* ---------- Main explorer ---------- */
    .main{background:var(--card);padding:16px;border-radius:12px;border:1px solid var(--glass)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1}
    input[type="text"],input[type="password"],select{background:transparent;border:1px solid var(--glass);padding:8px 10px;border-radius:8px;color:var(--text);width:100%}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px;border:1px solid var(--glass)}

    /* file list */
    .files{margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:12px}
    .file{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px}
    .file .meta{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}

    /* admin modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center}
    .modal{background:var(--card);padding:18px;border-radius:12px;width:420px;max-width:94%;border:1px solid var(--glass)}
    .modal.show{display:block}

    /* admin panel */
    .admin-panel{display:flex;flex-direction:column;gap:12px}
    .warn{background:linear-gradient(90deg,var(--danger),#ff7a7a);padding:10px;border-radius:8px;color:var(--white);font-weight:600}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    /* small touches */
    .muted{color:var(--muted)}
    .inline{display:inline-flex;gap:8px;align-items:center}
    .kbd{background:var(--glass);padding:6px 8px;border-radius:8px;font-size:12px}
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">FE</div>
        <div>
          <h1>NPC File Explorer</h1>
          <div class="muted">演示用的网页版文件浏览器原型 — 可在本地/设备上运行（非生产）</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="themeToggle">切换 深/白</button>
        <button class="btn" id="openAdmin">管理员后台</button>
      </div>
    </header>

    <div class="layout">
      <aside class="sidebar">
        <h3>操作</h3>
        <div class="navitem card" id="createFileBtn">+ 新建文件</div>
        <div class="navitem card" id="createFolderBtn">+ 新建文件夹</div>
        <div style="height:10px"></div>
        <h3>信息</h3>
        <div class="card">
          <div>默认管理帐号: <strong>admin</strong></div>
          <div>默认密码: <strong>123456</strong></div>
          <div class="muted" style="margin-top:8px">提示：后台凭证可在登录后自定义，强烈建议更改默认密码，否则可能会被盗取（本示例仅存于浏览器本地，不安全）。</div>
        </div>
      </aside>

      <main class="main">
        <div class="toolbar">
          <input type="text" id="search" class="search" placeholder="搜索文件/文件夹..." />
          <label class="btn"><input type="file" id="fileInput" style="display:none" multiple /> 上传文件</label>
          <button class="btn" id="refreshBtn">刷新</button>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong>根目录</strong>
              <div class="muted">显示模拟的文件与文件夹（数据保存在浏览器 localStorage）</div>
            </div>
            <div class="inline muted">设备适配 · 响应式 · 深浅色模式</div>
          </div>

          <div class="files" id="filesContainer"></div>
        </div>

        <footer>
          © 2025 StavlyNg 归版权所有
        </footer>
      </main>
    </div>
  </div>

  <!-- ---------- Admin modal ---------- -->
  <div id="modal" class="modal-backdrop">
    <div class="modal card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">管理员登录</h3>
        <button class="btn" id="closeModal">关闭</button>
      </div>

      <div style="margin-top:12px">
        <div class="muted">输入管理员凭证以访问后台（示例：用户名 admin / 密码 123456）</div>
        <div style="height:10px"></div>
        <div>
          <label>用户名</label>
          <input type="text" id="loginUser" value="" />
        </div>
        <div style="margin-top:8px">
          <label>密码</label>
          <input type="password" id="loginPass" />
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="doLogin">登录</button>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid var(--glass)" />

      <div id="adminArea" style="display:none">
        <h4>后台信息</h4>
        <div class="admin-panel">
          <div class="warn">重要提示：若不更改默认凭证，帐号可能被盗取。本示例凭证保存在浏览器 localStorage，仅用于演示，非安全存储方式。</div>

          <div class="card">
            <div><strong>当前用户名：</strong><span id="curUserDisplay"></span></div>
            <div><strong>当前密码（已隐藏）：</strong><span id="curPassDisplay">••••••••</span></div>
          </div>

          <div class="card">
            <label>修改用户名</label>
            <input type="text" id="newUser" placeholder="新用户名" />
            <div style="height:8px"></div>
            <label>修改密码</label>
            <input type="password" id="newPass" placeholder="新密码" />
            <div style="height:10px"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end">
              <button class="btn" id="saveCred">保存</button>
              <button class="btn" id="logoutBtn">登出</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- Helper / Storage ---------- */
    const LS_KEYS = {FILES:'npc_files_v1', CRED:'npc_admin_cred_v1', THEME:'npc_theme_v1'};

    // 默认凭证（可修改）
    const defaultCred = {user:'admin', pass:'123456'};

    function loadCred(){
      try{
        const raw = localStorage.getItem(LS_KEYS.CRED);
        if(!raw) return {...defaultCred};
        return JSON.parse(raw);
      }catch(e){return {...defaultCred}}
    }
    function saveCred(c){ localStorage.setItem(LS_KEYS.CRED, JSON.stringify(c)); }

    // 模拟文件系统（非常简单）
    function loadFiles(){
      try{ const raw = localStorage.getItem(LS_KEYS.FILES); return raw?JSON.parse(raw):[ {id:1,name:'示例文件.txt',size:'2 KB',type:'file',modified: (new Date()).toLocaleString()}, {id:2,name:'图片',type:'folder',modified:(new Date()).toLocaleString()} ]; }catch(e){return []}
    }
    function saveFiles(arr){ localStorage.setItem(LS_KEYS.FILES, JSON.stringify(arr)); }

    // ---------- UI Bind ----------
    const filesContainer = document.getElementById('filesContainer');
    const searchInput = document.getElementById('search');
    const fileInput = document.getElementById('fileInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const createFileBtn = document.getElementById('createFileBtn');
    const createFolderBtn = document.getElementById('createFolderBtn');

    let files = loadFiles();

    function renderFiles(filter=''){
      filesContainer.innerHTML = '';
      const out = files.filter(f=>f.name.toLowerCase().includes(filter.toLowerCase()));
      if(out.length===0){ filesContainer.innerHTML = '<div class="muted">暂无文件 — 试试上传或新建</div>'; return }
      out.forEach(f=>{
        const el = document.createElement('div'); el.className='file card';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(f.name)}</strong></div><div class="muted">${f.type}</div></div><div class="meta"><span>${f.size||''}</span><span>${f.modified||''}</span></div>`;
        filesContainer.appendChild(el);
      })
    }

    function escapeHtml(s){ return s.replace(/[&<>\"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    searchInput.addEventListener('input', ()=>renderFiles(searchInput.value));
    refreshBtn.addEventListener('click', ()=>{ files = loadFiles(); renderFiles(searchInput.value); });

    fileInput.addEventListener('change', (e)=>{
      const chosen = Array.from(e.target.files);
      chosen.forEach(f=>{
        const item = {id:Date.now()+Math.random(), name:f.name, size:(Math.round(f.size/1024)) + ' KB', type:'file', modified:(new Date()).toLocaleString()};
        files.unshift(item);
      });
      saveFiles(files); renderFiles(searchInput.value);
      fileInput.value='';
    });

    createFileBtn.addEventListener('click', ()=>{
      const name = prompt('请输入新文件名（例如 readme.md）');
      if(!name) return;
      files.unshift({id:Date.now(),name, size:'0 KB', type:'file', modified:(new Date()).toLocaleString()}); saveFiles(files); renderFiles(searchInput.value);
    });
    createFolderBtn.addEventListener('click', ()=>{
      const name = prompt('请输入新文件夹名'); if(!name) return; files.unshift({id:Date.now(),name,type:'folder',modified:(new Date()).toLocaleString()}); saveFiles(files); renderFiles(searchInput.value);
    });

    // initial render
    renderFiles();

    // ---------- Theme ----------
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    const savedTheme = localStorage.getItem(LS_KEYS.THEME) || 'dark';
    body.setAttribute('data-theme', savedTheme);
    themeToggle.addEventListener('click', ()=>{
      const cur = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', cur); localStorage.setItem(LS_KEYS.THEME, cur);
    });

    // ---------- Admin modal & auth ----------
    const modal = document.getElementById('modal');
    const openAdmin = document.getElementById('openAdmin');
    const closeModal = document.getElementById('closeModal');
    const doLogin = document.getElementById('doLogin');
    const loginUser = document.getElementById('loginUser');
    const loginPass = document.getElementById('loginPass');
    const adminArea = document.getElementById('adminArea');
    const curUserDisplay = document.getElementById('curUserDisplay');
    const curPassDisplay = document.getElementById('curPassDisplay');
    const newUser = document.getElementById('newUser');
    const newPass = document.getElementById('newPass');
    const saveCredBtn = document.getElementById('saveCred');
    const logoutBtn = document.getElementById('logoutBtn');

    function openModal(){ modal.style.display='flex'; }
    function closeModalFn(){ modal.style.display='none'; hideAdmin(); }

    openAdmin.addEventListener('click', openModal);
    closeModal.addEventListener('click', closeModalFn);

    function showAdmin(){ adminArea.style.display='block'; }
    function hideAdmin(){ adminArea.style.display='none'; }

    function updateAdminDisplay(){ const c = loadCred(); curUserDisplay.textContent = c.user; curPassDisplay.textContent = '●'.repeat(8); }

    // login action
    doLogin.addEventListener('click', ()=>{
      const cred = loadCred();
      if(loginUser.value === cred.user && loginPass.value === cred.pass){
        // success
        showAdmin(); updateAdminDisplay();
        loginUser.value=''; loginPass.value='';
      }else{
        alert('登录失败：用户名或密码错误');
      }
    });

    saveCredBtn.addEventListener('click', ()=>{
      const c = loadCred();
      const u = newUser.value.trim(); const p = newPass.value.trim();
      if(u) c.user = u; if(p) c.pass = p;
      saveCred(c); updateAdminDisplay(); newUser.value=''; newPass.value='';
      alert('凭证已保存（存储在浏览器 localStorage，非安全）。');
    });

    logoutBtn.addEventListener('click', ()=>{ hideAdmin(); alert('已登出后台'); });

    // close when clicking backdrop
    modal.addEventListener('click', (ev)=>{ if(ev.target === modal) closeModalFn(); });

    // ---------- small UX helpers ----------
    // keyboard: Ctrl+K focuses search
    document.addEventListener('keydown', (e)=>{ if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); searchInput.focus(); } });

    // expose for debugging in console
    window._npc = { loadFiles, saveFiles, loadCred, saveCred };
  </script>
</body>
</html>
